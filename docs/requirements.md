# 宝塔面板（BT Panel）AstrBot 插件需求文档

## 1. 背景与目标
- **背景**：用户希望在 AstrBot 中便捷调用宝塔面板（BT Panel）API，实现对服务器状态与站点管理的常用查询与维护操作。
- **目标**：提供一个安全、可配置、稳健的 AstrBot 插件，支持调用 BT Panel API 并以机器人指令方式输出结果。

## 2. 使用范围
- **适用用户**：使用 AstrBot 的运维或开发人员。
- **适用场景**：
  - 查询面板系统状态（CPU/内存/磁盘等）。
  - 查询站点列表。
  - 基础运维动作（如面板重启）。

## 3. 功能需求
### 3.1 指令与功能
1. **`bt status`**
   - 功能：获取面板系统状态（CPU、内存、磁盘、网络等摘要信息）。
   - 输出：结构化文本，包含关键指标与更新时间。

2. **`bt sites`**
   - 功能：获取站点列表。
   - 输出：站点名称、状态（运行/停止）、绑定域名等摘要信息。

3. **`bt restart panel`**
   - 功能：重启面板服务。
   - 输出：操作成功/失败及提示信息。

4. **`bt help`**
   - 功能：输出可用命令说明。

### 3.2 配置项
插件需支持以下配置：
- `base_url`：BT Panel 地址（例：`https://example.com:8888`）。
- `api_key`：BT Panel API 密钥。
- `timeout_seconds`：请求超时（默认 10 秒）。
- `verify_tls`：是否校验证书（默认 true）。
- `token_mode`：签名模式（兼容不同 API 文档实现）。
  - `time+key`：`md5(time + key)`
  - `time+md5key`：`md5(time + md5(key))`

## 4. 非功能需求
- **安全性**：API Key 不输出到日志或消息中，支持 TLS 校验关闭但默认开启。
- **稳定性**：
  - 请求异常需被捕获并给出清晰错误信息。
  - API 返回非 JSON 或缺少字段时，需提供降级处理。
- **可维护性**：
  - 代码应模块化，包含独立 API Client。
  - 提供清晰 README 与配置说明。

## 5. 约束与假设
- BT Panel API 文档可用，插件按照常见签名方式实现并提供可配置签名模式。
- AstrBot 插件系统支持以 `register(bot)` 方式注册指令回调。

## 6. 交付物
- 插件代码（包含 API Client、指令处理逻辑）。
- README（安装与配置说明）。
- 需求文档（本文件）。
- 插件清单 `plugin.json` 与配置 schema（用于 AstrBot 插件系统识别与校验）。
